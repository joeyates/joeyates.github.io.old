
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Joe Yates' Blog</title>
  <meta name="author" content="Joe Yates">

  
  <meta name="description" content="Mix tasks are helper tasks in Elixir projects. In this post, I&rsquo;ll create an empty project and a &ldquo;Hello World!&rdquo; I can create a new &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://joeyates.github.io">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Joe Yates' Blog" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Joe Yates' Blog</a></h1>
  
    <h2>Programming and DevOps</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:joeyates.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/joeyates-curriculum-vitae.pdf">Curriculum vitae</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2015/07/25/create-a-mix-task-for-an-elixir-project/">Create a Mix Task for an Elixir Project</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2015-07-25T11:36:16+02:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Mix tasks are helper tasks in Elixir projects.</p>

<p>In this post, I&rsquo;ll create an empty project and a &ldquo;Hello World!&rdquo;</p>

<p>I can create a new project with</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>mix new mix_task_example
</span></code></pre></td></tr></table></div></figure>


<p>Now, inside the new <code>mix_task_example</code> project directory, running</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>mix <span class="nb">help</span>
</span></code></pre></td></tr></table></div></figure>


<p>shows which mix tasks are available and in this newly created project there
are already more than 30.</p>

<p>Now I create the directory for tasks with</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>mkdir -p lib/mix/tasks
</span></code></pre></td></tr></table></div></figure>


<p>and create a file with the name of the task, e.g. <code>mix_task_example.salute.ex</code>
with the following contents:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='elixir'><span class='line'><span class="kd">defmodule</span> <span class="nc">Mix.Tasks.MixTaskExample.Salute</span> <span class="k">do</span>
</span><span class='line'>  <span class="kn">use</span> <span class="nc">Mix.Task</span>
</span><span class='line'>
</span><span class='line'>  <span class="kd">def</span> <span class="n">run</span><span class="p">(</span><span class="bp">_</span><span class="p">)</span> <span class="k">do</span>
</span><span class='line'>    <span class="nc">IO</span><span class="p">.</span><span class="n">puts</span> <span class="s2">&quot;Hello World!&quot;</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>This far, the task is not yet available, I need to compile the project</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='elixir'><span class='line'><span class="n">mix</span> <span class="n">compile</span>
</span></code></pre></td></tr></table></div></figure>


<p>And now I can run it with</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>mix mix_task_example.salute
</span><span class='line'>Hello World!
</span></code></pre></td></tr></table></div></figure>


<p>The task doesn&rsquo;t show up in the listing with <code>mix help</code>.
To make it show up I need to add @shortdoc</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='elixir'><span class='line'><span class="kd">defmodule</span> <span class="nc">Mix.Tasks.MixTaskExample.Salute</span> <span class="k">do</span>
</span><span class='line'>  <span class="kn">use</span> <span class="nc">Mix.Task</span>
</span><span class='line'>
</span><span class='line'>  <span class="na">@shortdoc</span> <span class="s2">&quot;Give a short salutation&quot;</span>
</span><span class='line'>
</span><span class='line'>  <span class="kd">def</span> <span class="n">run</span><span class="p">(</span><span class="bp">_</span><span class="p">)</span> <span class="k">do</span>
</span><span class='line'>    <span class="nc">IO</span><span class="p">.</span><span class="n">puts</span> <span class="s2">&quot;Hello World!&quot;</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>If the tasks are part of a library, they will be available to project that
include it as a dependency, so it&rsquo;s important to use the library name
(e.g. <code>MixTaskExample</code>) in the module name in order to keep tasks in
a collective namesapce.</p>

<p>As a final touch, let&rsquo;s accept a parameter</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='elixir'><span class='line'><span class="kd">defmodule</span> <span class="nc">Mix.Tasks.MixTaskExample.Salute</span> <span class="k">do</span>
</span><span class='line'>  <span class="kn">use</span> <span class="nc">Mix.Task</span>
</span><span class='line'>
</span><span class='line'>  <span class="na">@shortdoc</span> <span class="s2">&quot;Give a short salutation&quot;</span>
</span><span class='line'>
</span><span class='line'>  <span class="kd">def</span> <span class="n">run</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="k">do</span>
</span><span class='line'>    <span class="nc">IO</span><span class="p">.</span><span class="n">puts</span> <span class="s2">&quot;Hello </span><span class="si">#{</span><span class="n">name</span><span class="si">}</span><span class="s2">!&quot;</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>mix compile
</span><span class='line'>mix mix_task_example.salute Joe
</span><span class='line'>Hello Joe!
</span></code></pre></td></tr></table></div></figure>


<p>A working mix task!</p>

<p>The code for this example can be found at <a href="https://github.com/joeyates/mix_task_example">https://github.com/joeyates/mix_task_example</a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2014/06/30/how-to-forward-blocks-in-ruby/">How to Forward Blocks in Ruby</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-06-30T09:51:19+02:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><h1>TL;DR</h1>

<p>Use <code>Proc.new</code></p>

<h1>Calling Enumerators - normal use</h1>

<p>You&rsquo;re writing some code which calls an Enumerator - a function that
makes repeated calls to the block of code that you provide.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">yield_me_2_things</span>
</span><span class='line'>  <span class="k">yield</span> <span class="s1">&#39;Thing 1&#39;</span>
</span><span class='line'>  <span class="k">yield</span> <span class="s1">&#39;Thing 2&#39;</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="n">yield_me_2_things</span> <span class="p">{</span> <span class="o">|</span><span class="n">x</span><span class="o">|</span> <span class="nb">puts</span> <span class="n">x</span> <span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>This will print:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">Thing</span> <span class="mi">1</span>
</span><span class='line'><span class="no">Thing</span> <span class="mi">2</span>
</span></code></pre></td></tr></table></div></figure>


<p>The values are supplied by <code>yield_me_2_things</code> and the printing is done in
the block, <code>{ |x| puts }</code>, that is passed to that method.</p>

<h1>Generalize</h1>

<p>I can now make a generalized method, to handle any number of things:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">yield_me_n_things</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
</span><span class='line'>  <span class="mi">1</span><span class="o">.</span><span class="n">upto</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">i</span><span class="o">|</span>
</span><span class='line'>    <span class="n">thing</span> <span class="o">=</span> <span class="s2">&quot;Thing </span><span class="si">#{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span class='line'>    <span class="k">yield</span> <span class="n">thing</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="n">yield_me_n_things</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="p">{</span> <span class="o">|</span><span class="n">x</span><span class="o">|</span> <span class="nb">puts</span> <span class="n">x</span> <span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>&hellip;the output is the same.</p>

<h1>An alternative: use a block</h1>

<p>I could equally have implemented the method using a <code>&amp;block</code> parameter -
for the caller, it makes no difference:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">call_this_block_with_n_things</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">block</span><span class="p">)</span>
</span><span class='line'>  <span class="mi">1</span><span class="o">.</span><span class="n">upto</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">i</span><span class="o">|</span>
</span><span class='line'>    <span class="n">thing</span> <span class="o">=</span> <span class="s2">&quot;Thing </span><span class="si">#{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span class='line'>    <span class="n">block</span><span class="o">.</span><span class="n">call</span> <span class="n">thing</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="n">call_this_block_with_n_things</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="p">{</span> <span class="o">|</span><span class="n">x</span><span class="o">|</span> <span class="nb">puts</span> <span class="n">x</span> <span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>&hellip;the output is the same.</p>

<h1>The problem</h1>

<p>What if I want one Enumerator to call another?</p>

<p>What if I want to keep the specific version (<code>yield_me_2_things</code>)
but just make it call the generalized method?</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">enumerate_n_things</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="c1"># How do I receive the block?</span>
</span><span class='line'>  <span class="mi">1</span><span class="o">.</span><span class="n">upto</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">i</span><span class="o">|</span>
</span><span class='line'>    <span class="n">thing</span> <span class="o">=</span> <span class="s2">&quot;Thing </span><span class="si">#{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span class='line'>    <span class="c1"># How do I call the block?</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">enumerate_2_things</span>
</span><span class='line'>  <span class="n">enumerate_n_things</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="c1"># How do I forward the block?</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="n">enumerate_2_things</span> <span class="p">{</span> <span class="o">|</span><span class="n">x</span><span class="o">|</span> <span class="nb">puts</span> <span class="n">x</span> <span class="p">}</span>
</span><span class='line'><span class="n">enumerate_2_things</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="p">{</span> <span class="o">|</span><span class="n">x</span><span class="o">|</span> <span class="nb">puts</span> <span class="n">x</span> <span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>How should I write the two methods, while keeping both usable indipendently?</p>

<h1>Attempt 1: Forward using yield</h1>

<p>With <code>yield</code>, you don&rsquo;t explicitly receive the block, you just call it.
Does that work across two levels? I.e., does the block get passed to method I call?</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">enumerate_n_things</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
</span><span class='line'>  <span class="mi">1</span><span class="o">.</span><span class="n">upto</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">i</span><span class="o">|</span>
</span><span class='line'>    <span class="n">thing</span> <span class="o">=</span> <span class="s2">&quot;Thing </span><span class="si">#{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span class='line'>    <span class="k">yield</span> <span class="n">thing</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">enumerate_2_things</span>
</span><span class='line'>  <span class="n">enumerate_n_things</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="n">enumerate_2_things</span> <span class="p">{</span> <span class="o">|</span><span class="n">x</span><span class="o">|</span> <span class="nb">puts</span> <span class="n">x</span> <span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>No, doesn&rsquo;t work, <code>enumerate_n_things</code> doesn&rsquo;t receive a block.</p>

<p>I get this error:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">no</span> <span class="n">block</span> <span class="n">given</span> <span class="p">(</span><span class="k">yield</span><span class="p">)</span> <span class="p">(</span><span class="no">LocalJumpError</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<h1>Attempt 2: Forward using a block</h1>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">enumerate_n_things</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">block</span><span class="p">)</span> <span class="c1"># Note: no &#39;&amp;&#39;</span>
</span><span class='line'>  <span class="mi">1</span><span class="o">.</span><span class="n">upto</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">i</span><span class="o">|</span>
</span><span class='line'>    <span class="n">thing</span> <span class="o">=</span> <span class="s2">&quot;Thing </span><span class="si">#{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span class='line'>    <span class="n">block</span><span class="o">.</span><span class="n">call</span> <span class="n">thing</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">enumerate_2_things</span><span class="p">(</span><span class="o">&amp;</span><span class="n">block</span><span class="p">)</span>
</span><span class='line'>  <span class="n">enumerate_n_things</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">block</span><span class="p">)</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="n">enumerate_2_things</span> <span class="p">{</span> <span class="o">|</span><span class="n">x</span><span class="o">|</span> <span class="nb">puts</span> <span class="n">x</span> <span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Prints:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">Thing</span> <span class="mi">1</span>
</span><span class='line'><span class="no">Thing</span> <span class="mi">2</span>
</span></code></pre></td></tr></table></div></figure>


<p>But we can no longer pass a block to the generalized method:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">enumerate_n_things</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="p">{</span> <span class="o">|</span><span class="n">x</span><span class="o">|</span> <span class="nb">puts</span> <span class="n">x</span> <span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p><code>enumerate_n_things</code> now expects the block as a normal parameter.</p>

<p>I get this error:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">wrong</span> <span class="n">number</span> <span class="n">of</span> <span class="n">arguments</span> <span class="p">(</span><span class="mi">1</span> <span class="k">for</span> <span class="mi">2</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<h1>Solution: Proc.new</h1>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">enumerate_n_things</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">block</span> <span class="o">=</span> <span class="no">Proc</span><span class="o">.</span><span class="n">new</span><span class="p">)</span>
</span><span class='line'>  <span class="mi">1</span><span class="o">.</span><span class="n">upto</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">i</span><span class="o">|</span>
</span><span class='line'>    <span class="n">thing</span> <span class="o">=</span> <span class="s2">&quot;Thing </span><span class="si">#{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span class='line'>    <span class="n">block</span><span class="o">.</span><span class="n">call</span> <span class="n">thing</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">enumerate_2_things</span><span class="p">(</span><span class="n">block</span> <span class="o">=</span> <span class="no">Proc</span><span class="o">.</span><span class="n">new</span><span class="p">)</span>
</span><span class='line'>  <span class="n">enumerate_n_things</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">block</span><span class="p">)</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="n">enumerate_2_things</span> <span class="p">{</span> <span class="o">|</span><span class="n">x</span><span class="o">|</span> <span class="nb">puts</span> <span class="n">x</span> <span class="p">}</span>
</span><span class='line'><span class="n">enumerate_n_things</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="p">{</span> <span class="o">|</span><span class="n">x</span><span class="o">|</span> <span class="nb">puts</span> <span class="n">x</span> <span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Both calls now work!</p>

<p><code>Proc.new</code> transforms any block passed to a method into a Proc.
If we use that as the default value for a block parameter we can
call methods directly with blocks, or forward blocks between
enumerators.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2013/12/29/instant-sinatra-starter/">Instant Sinatra Starter</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-12-29T14:36:04+01:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I was asked to write a book about Sinatra, to be published by Packt Publishing.</p>

<p><img src="/images/SinatraStarterCover.png" alt="Instant Sinatra Starter" /></p>

<p>The book is called &ldquo;Instant Sinatra Starter&rdquo; and is part of Packtpub&rsquo;s Instant series.</p>

<p>Although the book is very short - the final version is 48 pages - it took about six
months from initial planning to publication.</p>

<p>My target audience is people who have a little programming experience, so it doesn&rsquo;t
aim to teach you programming in general, or Ruby specifically.</p>

<p>The main section of the book follows the steps you need to develop an address book
application.</p>

<p>The topics covered are:</p>

<ul>
<li>Sinatra setup,</li>
<li>Templating (using Slim),</li>
<li>Getting an app online using Heroku,</li>
<li>GET and POST requests,</li>
<li>Integration testing,</li>
<li>Database access.</li>
</ul>


<p>The code from the book is <a href="https://github.com/joeyates/sinatra-address-book">available on GitHub</a>.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2012/12/23/my-everyday-find-command/">My Everyday Find Command</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-12-23T14:08:00+01:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>When I&rsquo;m searching for files, I use this function:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c"># f - everyday find</span>
</span><span class='line'><span class="c"># usage:</span>
</span><span class='line'><span class="c">#   f filename_fragment [path]</span>
</span><span class='line'><span class="c"># skips whatever you list in _exclude_matches</span>
</span><span class='line'><span class="nv">_exclude_matches</span><span class="o">=(</span>bundle .git *.pyc<span class="o">)</span>
</span><span class='line'><span class="nv">_excludes</span><span class="o">=</span><span class="s1">&#39;&#39;</span>
</span><span class='line'><span class="k">for</span> _match in <span class="nv">$_exclude_matches</span><span class="p">;</span> <span class="k">do</span>
</span><span class='line'>  <span class="nv">_excludes</span><span class="o">=</span><span class="s2">&quot;${_excludes}-name &#39;$_match&#39; -prune -o &quot;</span>
</span><span class='line'><span class="k">done</span>
</span><span class='line'>
</span><span class='line'><span class="nb">eval</span> <span class="s2">&quot;</span>
</span><span class='line'><span class="s2">function my_everyday_find() {</span>
</span><span class='line'><span class="s2">  find \$2 \</span>
</span><span class='line'><span class="s2">    $_excludes \</span>
</span><span class='line'><span class="s2">    -name \&quot;*\$1*\&quot;    \</span>
</span><span class='line'><span class="s2">    -print;</span>
</span><span class='line'><span class="s2">}</span>
</span><span class='line'><span class="s2">&quot;</span>
</span><span class='line'><span class="nb">unset </span>_exclude_matches _excludes _match
</span><span class='line'><span class="nb">alias </span><span class="nv">f</span><span class="o">=</span>my_everyday_find
</span></code></pre></td></tr></table></div></figure>


<p>It searches for files and directories with partial matches of the first parameter:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>f 26
</span><span class='line'>./db/migrate/20121003094826_add_foo_to_bar.rb
</span></code></pre></td></tr></table></div></figure>


<p>If I supply a second parameter, it is taken as the directory to search in:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>f <span class="m">26</span> ..
</span><span class='line'>../api/db/migrate/20121003094826_add_foo_to_bar.rb
</span><span class='line'>../redmine/db/migrate/20091017212644_add_missing_indexes_to_messages.rb
</span></code></pre></td></tr></table></div></figure>



</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2012/01/16/ruby-bareword-assignment-and-method-calls-with-implicit-self/">Ruby Bareword Assignment and Method Calls With Implicit Self</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-01-16T18:52:00+01:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><h1>Problem</h1>

<p>If I do this:</p>

<figure class='code'><figcaption><span>Problem - problem.rb </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='rb'><span class='line'><span class="nb">puts</span> <span class="n">foo</span>
</span><span class='line'><span class="n">foo</span> <span class="o">=</span> <span class="mi">3</span>
</span></code></pre></td></tr></table></div></figure>


<p>there is always the doubt whether I&rsquo;m accessing a local variable, or calling methods <code>foo</code> and <code>foo=</code>.</p>

<h1>TL;DR</h1>

<p>When you want to call an instance&rsquo;s own methods, use <code>self</code>:</p>

<figure class='code'><figcaption><span>TL;DR - tldr.rb </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='rb'><span class='line'><span class="nb">self</span><span class="o">.</span><span class="n">foo</span>             <span class="c1"># Calls foo</span>
</span><span class='line'><span class="nb">self</span><span class="o">.</span><span class="n">foo</span> <span class="o">=</span> <span class="s1">&#39;bar&#39;</span>     <span class="c1"># Calls foo=</span>
</span></code></pre></td></tr></table></div></figure>




</div>
  
  
    <footer>
      <a rel="full-article" href="/2012/01/16/ruby-bareword-assignment-and-method-calls-with-implicit-self/">Read on &rarr;</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2011/07/18/html-history-api/">HTML History API</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-07-18T00:00:00+02:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><img src="/images/html5-history-api.png" title="The Example App" ></p>

<p>
The HTML5 history API allows AJAX-based sites to avoid "breaking the back button". Every time you update the page, you store the new content is the window.history object. When the user presses the back button, you retrieve the current item from window.history and update the page with it.
</p>




</div>
  
  
    <footer>
      <a rel="full-article" href="/2011/07/18/html-history-api/">Read on &rarr;</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2011/03/06/overriding-the-insertion-operator-for-cpp-template-classes/">Overriding the Insertion Operator for C++ Template Classes</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-03-06T00:00:00+01:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><figure class='code'><figcaption><span>Dump an Active Record object to Standard Out - dump_active_record_object.cpp </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='cpp'><span class='line'><span class="n">Person</span> <span class="nf">person</span><span class="p">(</span> <span class="mi">123</span> <span class="p">);</span>
</span><span class='line'><span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">person</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<p>While working on my <a href="https://github.com/joeyates/cpp-active-record/">C++ ActiveRecord implementation</a>, I had a few problems implementing the insertion operator for the main ActiveRecord::Base class.</p>

<p>The class ActiveRecord::Base class is a template class, and the problem was how to correctly declare the operator.</p>

<p>At the time I was unable to find examples on the Internet, so I thought I&rsquo;d provide my own.</p>

</div>
  
  
    <footer>
      <a rel="full-article" href="/2011/03/06/overriding-the-insertion-operator-for-cpp-template-classes/">Read on &rarr;</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2011/02/19/hello-gosu/">Hello Gosu!</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-02-19T00:00:00+01:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><img src="/images/hello_gosu.png" title="Hello Gosu!" ></p>

<p>I&rsquo;m trying out <a href="http://www.libgosu.org/">Gosu</a>, which is a 2D game library written in C++ with Ruby bindings (<a href="https://secure.wikimedia.org/wikipedia/en/wiki/Gosu_%28library%29">Wikipedia article</a>).</p>

</div>
  
  
    <footer>
      <a rel="full-article" href="/2011/02/19/hello-gosu/">Read on &rarr;</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2010/08/29/use-g-as-an-alias-for-git-without-losing-autocompletion/">Use 'G' as an Alias for 'Git' Without Losing Autocompletion</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-08-29T00:00:00+02:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>
I've just started using a new kind of abbreviation system for Git:
<ul>
	<li>I use 'g' instead of 'git',</li>
	<li>I've set up bash autocompletion for 'g', just like 'git'.</li>
</ul>
</p>

</div>
  
  
    <footer>
      <a rel="full-article" href="/2010/08/29/use-g-as-an-alias-for-git-without-losing-autocompletion/">Read on &rarr;</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2010/08/29/rake-builder/">Rake::Builder</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-08-29T00:00:00+02:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><figure class='code'><figcaption><span>Use Rake::Builder as a Make Replacement - build.sh </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>rake build
</span></code></pre></td></tr></table></div></figure>


<p>I&rsquo;ve put together a rake-based system for building C and C++ projects.</p>

<p>
I've called it Rake::Builder, it's available on GitHub <a href="http://github.com/joeyates/rake-builder">here</a>.
</p>




</div>
  
  
    <footer>
      <a rel="full-article" href="/2010/08/29/rake-builder/">Read on &rarr;</a>
    </footer>
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="2">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <header>
    <h1>My book about Sinatra</h1>
  </header>
  <div>
    <p>
      <a href="http://www.packtpub.com/sinatra-starter/book" target="_blank"><img src="/images/SinatraStarterCoverSmall.png" width="191" height="237"></a>
    </p>
    <p>
      <a href="http://www.packtpub.com/sinatra-starter/book" target="_blank">Instant Sinatra Starter</a>
      An intorduction to creating sites with Sinatra, from installation to testing to deployment.
    </p>
  </div>
</section>
<section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/2015/07/25/create-a-mix-task-for-an-elixir-project/">Create a Mix Task for an Elixir Project</a>
      </li>
    
      <li class="post">
        <a href="/2014/06/30/how-to-forward-blocks-in-ruby/">How to Forward Blocks in Ruby</a>
      </li>
    
      <li class="post">
        <a href="/2013/12/29/instant-sinatra-starter/">Instant Sinatra Starter</a>
      </li>
    
      <li class="post">
        <a href="/2012/12/23/my-everyday-find-command/">My Everyday Find Command</a>
      </li>
    
      <li class="post">
        <a href="/2012/01/16/ruby-bareword-assignment-and-method-calls-with-implicit-self/">Ruby Bareword Assignment and Method Calls With Implicit Self</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/joeyates">@joeyates</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'joeyates',
            count: 0,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>


  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2015 - Joe Yates -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
